<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="content">
		<p:ajaxStatus onstart="PF('statusDialog').show()"
			onsuccess="PF('statusDialog').hide()" />
		<p:dialog modal="true" widgetVar="statusDialog" header="Loading"
			draggable="false" closable="false">
			<p:graphicImage
				value="#{facesContext.externalContext.request.scheme}://#{facesContext.externalContext.request.serverName}:#{facesContext.externalContext.request.serverPort}#{facesContext.externalContext.request.contextPath}/images/ajaxloadingbar.gif" />
		</p:dialog>

		<!-- Expired session -->
		<p:idleMonitor onactive="PF('sessionTimeOutDialog').show();"
			timeout="#{session.maxInactiveInterval * 1000}" />
		<p:dialog modal="true" widgetVar="sessionTimeOutDialog"
			header="Expired session" draggable="false" closable="false">
			<h:outputText value="The session is finished" />
			<input id="confirmBackToLogin" type="button" value="Sign in"
				onclick="window.location='#{facesContext.externalContext.requestContextPath}/index.jsp';" />
		</p:dialog>

		<!--..............................................Form............................................... -->
		<h:form id="formDialog">
			<p:growl id="men" />
			<p:panel id="pnlContainer" header="Informacion">
				<p:panel id="panelSom">

					<p:selectOneMenu id="somProyecto"
						binding="#{vtDesarrolladorView.somProyectos}">
						<f:selectItem itemValue="-1" itemLabel="-Proyecto-" />
						<f:selectItems value="#{vtDesarrolladorView.losProyectos}" />
						<p:ajax listener="#{vtDesarrolladorView.proyectoListener}"
							update="somBacklogs, panelSom" />
					</p:selectOneMenu>

					<p:selectOneMenu id="somBacklogs"
						binding="#{vtDesarrolladorView.somBacklogs}">
						<f:selectItem itemValue="-1" itemLabel="-Pila producto-" />
						<f:selectItems value="#{vtDesarrolladorView.losBacklogs}" />
						<p:ajax listener="#{vtDesarrolladorView.backlogListener}"
							update="dtArtefactos, panelSom" />
					</p:selectOneMenu>

					<div align="center">
						<p:commandButton id="btnCrearArt" icon="fa fa-plus white"
							value="Crear Artefacto" update="men, pnlContainer"
							action="#{vtDesarrolladorView.crearArtefactoAction}" />
					</div>
				</p:panel>

				<p:panel id="panelDt">
					<p:contextMenu for="dtArtefactos" event="click contextmenu">
						<p:menuitem value="Progreso de este artefacto"
							update="men, pnlProgreso" icon="fa fa-wrench"
							action="#{vtDesarrolladorView.artefactoSeleccionadoAction}" />

						<p:menuitem value="Historial de Progreso del artefacto"
							update="panelDt" icon="fa fa-history "
							action="#{vtDesarrolladorView.historiaProgresoAction}"
							oncomplete="PF('dlgHistoriaArtefacto').show()" />

						<p:menuitem value="Ver Archivos" icon="fa fa-list"
							oncomplete="PF('dlgArchivosDescArtefacto').show()"
							update="dtDescArtefactos" />

						<p:menuitem value="Historial del artefacto"
							update="panelHistorial" icon="fa fa-history "
							oncomplete="PF('dlgHistorialArtefacto').show()"
							action="#{vtDesarrolladorView.artefactoSesionAction}" />


					</p:contextMenu>

					<p:dataTable id="dtArtefactos"
						value="#{vtDesarrolladorView.losArtefactos}" var="artefacto"
						paginator="true" rows="10"
						paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowsPerPageTemplate="10, 15" rowKey="#{artefacto.arteCodigo}"
						emptyMessage="No se encontraron los artefactos"
						selection="#{vtDesarrolladorView.artefactoSeleccionado}"
						selectionMode="single" paginatorPosition="bottom">

						<p:column headerText="Nombre Artefacto"
							filterBy="#{artefacto.titulo}" sortBy="#{artefacto.titulo}"
							filterMatchMode="contains">
							<h:outputText value="#{artefacto.titulo}"
								title="Presiona click derecho para ver las opciones" />
						</p:column>

						<p:column headerText="Puntos" filterBy="#{artefacto.puntos}"
							filterMatchMode="contains" sortBy="#{artefacto.puntos}">
							<h:outputText value="#{artefacto.puntos}"
								title="Presiona click derecho para ver las opciones" />
						</p:column>

						<p:column headerText="Estado del Artefacto"
							filterBy="#{artefacto.vtEstado.nombre}"
							sortBy="#{artefacto.vtEstado.nombre}" filterMatchMode="contains">
							<h:outputText value="#{artefacto.vtEstado.nombre}"
								title="Presiona click derecho para ver las opciones" />
						</p:column>

						<p:column headerText="Sprint"
							filterBy="#{artefacto.vtSprint.spriCodigo}"
							filterMatchMode="contains"
							sortBy="#{artefacto.vtSprint.spriCodigo}">
							<h:outputText value="#{artefacto.vtSprint.nombre}"
								title="Presiona click derecho para ver las opciones" />
						</p:column>
						<p:column headerText="Estado del Sprint"
							filterBy="#{artefacto.vtSprint.vtEstadoSprint.nombre}"
							filterMatchMode="contains"
							sortBy="#{artefacto.vtSprint.vtEstadoSprint.nombre}">
							<h:outputText value="#{artefacto.vtSprint.vtEstadoSprint.nombre}"
								title="Presiona click derecho para ver las opciones" />
						</p:column>
					</p:dataTable>

					<!-- ...................................................... Dialog............................................................ -->
					<p:dialog header="Progreso del Artefacto"
						widgetVar="dlgProgresArtefacto" modal="true" id="dlProsArtefacto"
						width="700">
						<p:panel id="pnlProgreso" header="Progreso">
							<h:panelGrid columns="2">

								<h:outputText value="Titulo del artefacto" />
								<p:inputText id="txtNombre" placeholder="Título"
									binding="#{vtDesarrolladorView.txtNombreArtefacto}"
									disabled="true" />

								<h:outputText value="Estado Artefacto" />
								<p:selectOneMenu id="somCrearEstados"
									binding="#{vtDesarrolladorView.somEstadoArtefacto}">
									<f:selectItem itemValue="-1" itemLabel="-Estados-" />
									<f:selectItems
										value="#{vtDesarrolladorView.losEstadosArtefactos}" />
								</p:selectOneMenu>

							</h:panelGrid>

							<h:panelGrid columns="5" id="progresoArt">

								<h:outputText value="Puntos" />
								<p:inputMask id="txtPuntos"
									binding="#{vtDesarrolladorView.txtPuntos}" disabled="true" mask="99:99"/>

								<p:spacer width="100" height="10" />

								<h:outputText value="Esfuerzo Restante" />
								<p:inputMask id="txtEsfuerzoRestante"
									binding="#{vtDesarrolladorView.txtEsfuerzoRestante}"
									disabled="true" mask="99:99" />

								<h:outputText value="Esfuerzo Real" />
								<p:inputMask id="txtEsfuerzoReal"
									binding="#{vtDesarrolladorView.txtEsfuerzoReal}"
									disabled="true" mask="99:99" />

								<p:spacer width="100" height="10" />

								<h:outputText value="Tiempo Dedicado" />
								<p:inputMask id="txtTiempo" placeholder="Tiempo Dedicado"
									binding="#{vtDesarrolladorView.txtTiempoEstimado}" mask="99:99"/>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<h:outputText value="Descripción del Progreso" />
								<p:inputTextarea id="txtAreaDescripcion" cols="85"
									placeholder="Descripción" maxlength="2300"
									binding="#{vtDesarrolladorView.txtDescripcion}" />

							</h:panelGrid>
							<br />
							<p:commandButton id="btnCrearProgreso" icon="fa fa-plus white"
								action="#{vtDesarrolladorView.crearAction}" value="Crear"
								update="men, pnlProgreso" />

							<p:commandButton id="btnLimpiarProgreso"
								icon="fa fa-eraser white"
								action="#{vtDesarrolladorView.limpiarAction}" value="Limpiar"
								update="men, pnlProgreso" />
						</p:panel>
					</p:dialog>

					<p:dialog header="Progresos en el Artefacto"
						widgetVar="dlgHistoriaArtefacto" modal="true"
						id="dlHistoriaArtefacto" width="700">
						<p:panel id="pnlHistorial" header="Historia">
							<p:dataTable id="dtHistoriaProgreso"
								value="#{vtDesarrolladorView.losProgresos}" var="progreso"
								paginator="true" rows="10"
								paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								rowsPerPageTemplate="10, 15" rowKey="#{artefacto.arteCodigo}"
								emptyMessage="No se encontraron Progresos al Artefacto"
								paginatorPosition="bottom">

								<p:column headerText="Tiempo Dedicado"
									filterBy="#{progreso.tiempoDedicado}"
									sortBy="#{progreso.tiempoDedicado}" filterMatchMode="contains">
									<h:outputText value="#{progreso.tiempoDedicado}" />
								</p:column>

								<p:column headerText="Descripción"
									filterBy="#{progreso.descripcion}"
									sortBy="#{progreso.descripcion}" filterMatchMode="contains">
									<h:outputText value="#{progreso.descripcion}" />
								</p:column>

								<p:column headerText="Fecha"
									filterBy="#{progreso.fechaCreacion}"
									sortBy="#{progreso.fechaCreacion}" filterMatchMode="contains">
									<h:outputText value="#{progreso.fechaCreacion}">
										<f:convertDateTime dateStyle="full" type="date" />
									</h:outputText>
								</p:column>

							</p:dataTable>
						</p:panel>
					</p:dialog>


					<p:dialog header="Historial Artefacto"
						widgetVar="dlgHistorialArtefacto" modal="true"
						id="dlHistorialArtefacto" width="1200">
						<h:panelGrid columns="1" id="panelHistorial">
							<p:contextMenu for="dtHistorialArtefactos"
								event="click contextmenu">
								<p:menuitem value="Ver Historia"
									update="panelHistorial, pnlModificarHistoriaArtefacto"
									icon="fa fa-eye" oncomplete="PF('dlHistDet').show()"
									action="#{vtHistorialArtefactoView.hidratarArtefactoMod}" />

							</p:contextMenu>

							<p:dataTable id="dtHistorialArtefactos"
								value="#{vtHistorialArtefactoView.elHistorialArtefacto}"
								var="historialArtefacto" paginator="true" rows="5"
								rowKey="#{historialArtefacto.historiaCodigo}"
								selection="#{vtHistorialArtefactoView.historialArtefactoSeleccionado}"
								selectionMode="single" rendered="true"
								paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								rowsPerPageTemplate="5,10,15" paginatorPosition="bottom"
								emptyMessage="No se encontraron historias de este artefacto.">

								<p:column headerText="Codigo Historial"
									filterBy="#{historialArtefacto.historiaCodigo}"
									sortBy="#{historialArtefacto.historiaCodigo}">
									<h:outputText value="#{historialArtefacto.historiaCodigo}" />
								</p:column>

								<p:column headerText="Nombre Artefacto"
									filterBy="#{historialArtefacto.titulo}"
									sortBy="#{historialArtefacto.titulo}">
									<h:outputText value="#{historialArtefacto.titulo}" />
								</p:column>

								<p:column headerText="Fecha Creación"
									filterBy="#{historialArtefacto.fechaCreacion}"
									sortBy="#{historialArtefacto.fechaCreacion}">
									<h:outputText value="#{historialArtefacto.fechaCreacion}">
										<f:convertDateTime dateStyle="full" type="date" />
									</h:outputText>
								</p:column>

								<p:column headerText="Usuario Creador"
									filterBy="#{historialArtefacto.usuCreador}"
									sortBy="#{historialArtefacto.usuCreador}">
									<h:outputText value="#{historialArtefacto.usuCreador}" />
								</p:column>

								<p:column headerText="Usuario Modificador"
									filterBy="#{historialArtefacto.usuModificador}"
									sortBy="#{historialArtefacto.usuModificador}">
									<h:outputText value="#{historialArtefacto.usuModificador}" />
								</p:column>

							</p:dataTable>
						</h:panelGrid>
					</p:dialog>

					<p:dialog header="Historia Detallada del Artefacto"
						widgetVar="dlHistDet" modal="true" id="modHistArt" width="800"
						resizable="false">

						<p:panel header="Historia Detallada del Artefacto"
							id="pnlModificarHistoriaArtefacto">
							<div class="ui-fluid">

								<h:panelGrid columns="5" layout="grid">
									<h:outputText value="Titulo del artefacto" />
									<p:inputText id="txtHMNombre" placeholder="Título"
										binding="#{vtHistorialArtefactoView.txtHistorialNombre}"
										disabled="true" />

									<p:spacer width="100" height="10" />

									<h:outputText value="Origen del artefacto" />
									<p:inputText id="txtHMOrigen" placeholder="Origen"
										binding="#{vtHistorialArtefactoView.txtHistorialOrigen}"
										disabled="true" />
								</h:panelGrid>

								<h:panelGrid columns="1" layout="grid">

									<h:outputText value="Descripción del artefacto" />
									<p:inputTextarea id="txtAreaHMDescripcion" cols="148"
										placeholder="Descripción" maxlength="100000000"
										binding="#{vtHistorialArtefactoView.txtHtistorialDescripcion}"
										disabled="true" />
								</h:panelGrid>

								<h:panelGrid columns="5" id="panelHMGrid">

									<h:outputText value="Esfuerzo Estimado" />
									<p:inputText id="txtHMEsfuerzoEstimado"
										placeholder="Esfuerzo Estimado"
										binding="#{vtHistorialArtefactoView.txtHistorialEsfuerzoEstimado}"
										disabled="true" />


									<p:spacer width="100" height="10" />

									<h:outputText value="Esfuerzo Restante" />
									<p:inputText id="txtHMEsfuerzoRestante"
										placeholder="Esfuerzo Restante"
										binding="#{vtHistorialArtefactoView.txtHistorialEsfuerzoRestante}"
										disabled="true" />

									<h:outputText value="Esfuerzo Real" />
									<p:inputText id="txtHMEsfuerzoReal" placeholder="Esfuerzo Real"
										binding="#{vtHistorialArtefactoView.txtHistorialEsfuerzoReal}"
										disabled="true" />

									<p:spacer width="100" height="10" />

									<h:outputText value="Puntos del artefacto" />
									<p:inputText id="txtHMPuntos" placeholder="Puntos"
										binding="#{vtHistorialArtefactoView.txtHistorialPuntos}"
										disabled="true" />

									<h:outputText value="Artefacto Activo?" />
									<p:inputText id="txtHActivo" placeholder="Artefacto Activo"
										binding="#{vtHistorialArtefactoView.txtHistorialActivo}"
										disabled="true" />

									<p:spacer width="100" height="10" />

									<h:outputText value="Estado del artefacto" />
									<p:inputText id="txtHMEsta" placeholder="Estado"
										binding="#{vtHistorialArtefactoView.txtHistorialEstado}"
										disabled="true" />

									<h:outputText value="Tipo Artefacto" />
									<p:inputText id="txtHTipo" placeholder="Tipo Artefacto"
										binding="#{vtHistorialArtefactoView.txtHistorialTipo}"
										disabled="true" />

									<p:spacer width="100" height="10" />

									<h:outputText value="Prioridad del artefacto" />
									<p:inputText id="txtHMPrioridad" placeholder="Prioridad"
										binding="#{vtHistorialArtefactoView.txtHistorialPrio}"
										disabled="true" />

									<h:outputText value="Pila Producto" />
									<p:inputText id="txtHPila" placeholder="Pila Artefacto"
										binding="#{vtHistorialArtefactoView.txtHistorialPila}"
										disabled="true" />

									<p:spacer width="100" height="10" />

									<h:outputText value="Sprint del artefacto" />
									<p:inputText id="txtHMSprint" placeholder="Sprint"
										binding="#{vtHistorialArtefactoView.txtHistorialSprint}"
										disabled="true" />

									<br />
								</h:panelGrid>
							</div>

							<div align="center">
								<br />
								<p:commandButton id="btnVolverAEstado"
									binding="#{vtHistorialArtefactoView.btnAsignar}"
									icon="fa fa-pencil white" value="Restaurar artefacto"
									action="#{vtHistorialArtefactoView.asignarArtefactoAction}"
									update="panelHistorial, dtArtefactos" />
							</div>
						</p:panel>
					</p:dialog>


					<p:dialog header="Ver Archivos del Artefacto"
						widgetVar="dlgArchivosDescArtefacto" modal="true"
						id="dlArchivosDescArtefacto" width="500">

						<p:contextMenu for="dtDescArtefactos" event="click contextmenu">

							<p:menuitem value="Descargar Archivo" icon="fa fa-cloud-download"
								actionListener="#{vtDesarrolladorView.FileDownloadView}"
								ajax="false">

								<p:fileDownload value="#{vtDesarrolladorView.file}" />

							</p:menuitem>
						</p:contextMenu>


						<p:dataTable id="dtDescArtefactos"
							value="#{vtDesarrolladorView.losArchivos}" var="archivo"
							paginator="true" rows="5"
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							rowsPerPageTemplate="5,10,15" rendered="true"
							rowKey="#{archivo.archCodigo}"
							selection="#{vtDesarrolladorView.archivoSeleccionado}"
							emptyMessage="Lo siento, este artefacto no tiene archivos."
							selectionMode="single" paginatorPosition="bottom">

							<p:column headerText="Nombre Archivo"
								filterBy="#{archivo.nombre}" sortBy="#{archivo.nombre}">
								<h:outputText value="#{archivo.nombre}"
									title="Presiona click derecho para ver las opciones" />
							</p:column>

						</p:dataTable>
					</p:dialog>

					<!-- ................................................Dialog.................................................. -->
				</p:panel>


			</p:panel>
		</h:form>
		<!--..............................................Form............................................... -->
	</ui:define>

</ui:composition>