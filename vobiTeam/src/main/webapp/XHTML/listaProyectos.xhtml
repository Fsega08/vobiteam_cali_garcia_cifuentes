<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="content">
		<p:ajaxStatus onstart="PF('statusDialog').show()"
			onsuccess="PF('statusDialog').hide()" />
		<p:dialog modal="true" widgetVar="statusDialog" header="Loading"
			draggable="false" closable="false">
			<p:graphicImage
				value="#{facesContext.externalContext.request.scheme}://#{facesContext.externalContext.request.serverName}:#{facesContext.externalContext.request.serverPort}#{facesContext.externalContext.request.contextPath}/images/ajaxloadingbar.gif" />
		</p:dialog>

		<!-- Expired session -->
		<p:idleMonitor onactive="PF('sessionTimeOutDialog').show();"
			timeout="#{session.maxInactiveInterval * 1000}" />
		<p:dialog modal="true" widgetVar="sessionTimeOutDialog"
			header="Expired session" draggable="false" closable="false">
			<h:outputText value="The session is finished" />
			<input id="confirmBackToLogin" type="button" value="Sign in"
				onclick="window.location='#{facesContext.externalContext.requestContextPath}/index.jsp';" />
		</p:dialog>


		<h:form id="formDialog">
			<p:growl id="men" />

			<p:panel header="Proyectos" id="pnlDashboard">


				<p:panel>
					<div align="center">
						<p:commandButton id="btnCrearProyectos" value="Crear Proyecto"
							binding="#{vtProyectosView.btnCrearProyecto}"
							icon="fa fa-plus white" onclick="PF('dlgCrearProyecto').show();" />
					</div>
				</p:panel>


				<p:contextMenu for="dtProyectos">
					<p:menuitem value="Modificar" update="pnlModificarProyecto"
						icon="fa fa-pencil " oncomplete="PF('dlg2').show()"
						action="#{vtProyectosView.modificarListener}" />

					<p:menuitem value="Ir a la pila de producto" update="formDialog"
						icon="fa fa-list " action="#{vtProyectosView.backlogListener}" />

				</p:contextMenu>

				<p:dataTable id="dtProyectos"
					value="#{vtProyectosView.losProyectos}" var="proyecto"
					paginator="true" rows="10"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rowsPerPageTemplate="10,15" rowKey="#{proyecto.proyCodigo}"
					rendered="true" selection="#{vtProyectosView.proyectoSeleccionado}"
					selectionMode="single" paginatorPosition="bottom"
					emptyMessage="No existen proyectos de esta empresa, por que no creas uno ?">

					<p:column headerText="Nombre del Proyecto"
						filterBy="#{proyecto.nombre}" sortBy="#{proyecto.nombre}"
						filterMatchMode="contains">
						<h:outputText value="#{proyecto.nombre}"
							title="Presiona click derecho para ver las opciones" />
					</p:column>
					<p:column headerText="Descripcion del Proyecto"
						filterBy="#{proyecto.descripcion}"
						sortBy="#{proyecto.descripcion}" filterMatchMode="contains">
						<h:outputText value="#{proyecto.descripcion}"
							title="Presiona click derecho para ver las opciones" />
					</p:column>
					<p:column headerText="Estado del Proyecto"
						filterBy="#{proyecto.activo}" sortBy="#{proyecto.activo}">
						<h:outputText value="#{proyecto.activo}"
							title="Presiona click derecho para ver las opciones" />
					</p:column>

				</p:dataTable>

				<p:dialog header="Modificar Proyecto" widgetVar="dlg2" modal="true"
					id="modProyecto" width="500" resizable="false">
					<p:panel header="Modificar Proyecto" id="pnlModificarProyecto">
						<h:panelGrid columns="2">

							<h:outputText value="Nombre del Proyecto" />
							<p:inputText id="txtMNombre" placeholder="Nombre" size="31"
								binding="#{vtProyectosView.txtMNombre}" maxlength="100" />

							<h:outputText value="Descripcion del Proyecto" />
							<p:inputTextarea id="txtAreaMDescripcion" rows="7" cols="30"
								placeholder="Descripcion"
								binding="#{vtProyectosView.txtMDescripcion}"
								maxlength="100000000" />


							<h:outputText value="Estado del Proyecto" />
							<p:selectOneMenu id="somProyectoActivo"
								binding="#{vtProyectosView.somProyectoActivo}">
								<f:selectItem itemValue="-1" itemLabel="Proyecto Activo" />
								<f:selectItem itemValue="S" itemLabel="Activo" />
								<f:selectItem itemValue="N" itemLabel="Inactivo" />
							</p:selectOneMenu>

							<h:outputText value="Proyecto Público" />
							<p:selectOneMenu id="somProyectoPublico"
								binding="#{vtProyectosView.somProyectoPublico}">
								<f:selectItem itemValue="-1" itemLabel="Proyecto Publico" />
								<f:selectItem itemValue="S" itemLabel="Si" />
								<f:selectItem itemValue="N" itemLabel="No" />
							</p:selectOneMenu>
						</h:panelGrid>
						<br />
						<div align="center">
							<p:commandButton id="btnModificar" icon="fa fa-pencil white"
								value="Modificar" binding="#{vtProyectosView.btnModificar}"
								action="#{vtProyectosView.modificarAction}"
								update="pnlModificarProyecto,dtProyectos,men" />

							<p:commandButton id="btnLimpiar" icon="fa fa-eraser white"
								value="Limpiar" binding="#{vtProyectosView.btnMLimpiar}"
								action="#{vtProyectosView.limpiarAction}"
								update="pnlModificarProyecto" />
						</div>
					</p:panel>
				</p:dialog>


			</p:panel>


			<!-- Aca estan los botones que abren el dialogo
				 en la vista solo tengo el binding del boton
				 sin ninguna action
				 Lo que hago es uso el onClick para abrir un
				 panel que se encuentra en la misma ventana, TENER 
				 en cuenta que widgetVar es el nombre del dialog 
				 que quiero abrir -->
			<p:panel id="panelBotones">
				<div align="left">
					<p:commandButton id="btnRegresar" icon="fa fa-arrow-left  white"
						action="#{vtProyectosView.regresarAction}"
						value="Regresar a Lista de Empresas" update="formDialog" />
				</div>
			</p:panel>

			<!-- Aca lo que hago es meter todo el panel que quiere que muestre
				 en el dialog y le doy modal para que lo que este afuera
				 del panel que abre se vea opaco, eso es todo no tiene mucha ciencia
				 pero es efectivo como el solo TENER en cuenta que widgetVar
				 es el nombre del dialog que quiero abrir -->
			<p:dialog header="Crear Proyecto" widgetVar="dlgCrearProyecto"
				modal="true" width="500" resizable="false">
				<div align="center">
					<p:panel header="Crear Proyecto" id="pnlCrearProyecto">
						<h:panelGrid columns="2">

							<h:outputText value="Nombre del proyecto" />
							<p:inputText id="txtCNombre" placeholder="Nombre" size="31"
								binding="#{vtProyectosView.txtCNombre}" maxlength="100" />

							<h:outputText value="Descripción del proyecto" />
							<p:inputTextarea id="txtAreaDescripcion" rows="7" cols="30"
								placeholder="Descripcion"
								binding="#{vtProyectosView.txtCDescripcion}"
								maxlength="100000000" />


						</h:panelGrid>
						<br></br>
						<p:commandButton id="btnCrear" icon="fa fa-plus white"
							action="#{vtProyectosView.crearAction}" value="Crear"
							update="pnlCrearProyecto,dtProyectos,men" />


						<p:commandButton id="btnCLimpiar" icon="fa fa-eraser white"
							binding="#{vtProyectosView.btnCLimpiar}"
							action="#{vtProyectosView.limpiarCAction}" value="Limpiar"
							update="pnlCrearProyecto" />
					</p:panel>

				</div>
			</p:dialog>




		</h:form>

	</ui:define>

</ui:composition>